<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "./mybatis-3-mapper.dtd">
<mapper namespace="ItripComment">
    <!-- 用户分页查询条件 -->
    <sql id="whereClauseGetItripCommentPage">
        <where>
            <if test="hotelId != null and hotelId  != ''">
                and hotelid = #{hotelId}
            </if>
            <if test="isHavingImg != null and isHavingImg  != ''">
                and isHavingImg = #{isHavingImg}
            </if>
            <if test="isOk != null and isOk  != ''">
                and isOk = #{isOk}
            </if>
        </where>
    </sql>

    <!-- 获取用户列表 -->
    <select id="getItripCommentCount" resultType="java.lang.Integer">
        select count(*) from itrip_comment as table1
        <include refid="whereClauseGetItripCommentPage"></include>
    </select>

    <!-- 获取用户列表 分页-->
    <select id="getItripCommentPage" resultType="cn.itrip.beans.vo.ITripCommentVo" parameterType="map">
        SELECT
        id as id,
        hotelId as hotelId,
        productId as productId,
        productType as productType,
        content as content,
        userId as userId,
        (select u.userCode from itrip_user u where u.id = table1.userId) as userCode,
        (select hr.roomTitle from itrip_hotel_room hr where hr.id = table1.productId) as roomTitle,
        (select h.hotelLevel from itrip_hotel h where h.id = table1.hotelId) as hotelLevel,
        (select h.hotelName from itrip_hotel h where h.id = table1.hotelId) as hotelName,
        (select o.checkInDate from itrip_hotel_order o where o.id = table1.orderId) as checkInDate,
        isHavingImg as isHavingImg,
        positionScore as positionScore,
        facilitiesScore as facilitiesScore,
        serviceScore as serviceScore,
        hygieneScore as hygieneScore,
        score as score,
        tripMode as tripMode,
        isOk as isOk,
        creationDate as creationDate,
        createdBy as createdBy,
        modifyDate as modifyDate,
        modifiedBy as modifiedBy
        FROM
        itrip_comment table1
        <include refid="whereClauseGetItripCommentPage"></include>
        order by table1.creationDate desc
    </select>
</mapper>